<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>prueba | Sistema de Notas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; transition: all 0.3s ease; }
        
        /* Variables de colores */
        :root {
            --primary: #5549e6;
            --bg-light: #f1f5f9;
            --card-light: #ffffff;
            --text-light: #1e293b;
            
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --text-dark: #f1f5f9;
        }

        .dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .dark .glass-card {
            background-color: var(--card-dark);
            border-color: #334155;
        }

        .dark input {
            background-color: #334155;
            color: white;
            border-color: #475569;
        }

        .dark .navbar, .dark .table-card {
            background-color: var(--card-dark);
            color: white;
        }

        .hidden { display: none !important; }
        
        /* Animaci√≥n suave para el panel de personalizaci√≥n */
        #custom-menu { transform: translateY(-10px); opacity: 0; transition: 0.3s; pointer-events: none; }
        #custom-menu.show { transform: translateY(0); opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="fixed top-4 right-4 z-50">
        <button onclick="toggleCustomMenu()" class="bg-white dark:bg-slate-800 p-3 rounded-full shadow-lg border border-gray-200 dark:border-slate-700 hover:scale-110 transition">
            ‚öôÔ∏è <span id="lang-custom-btn">Personalizar</span>
        </button>
        
        <div id="custom-menu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-4 border border-gray-100 dark:border-slate-700">
            <p class="text-xs font-bold text-gray-400 uppercase mb-3 tracking-widest" id="lang-settings">Ajustes</p>
            
            <div class="mb-4">
                <label class="block text-sm mb-1" id="lang-theme">Modo:</label>
                <select onchange="setTheme(this.value)" id="theme-select" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-slate-700 text-sm outline-none">
                    <option value="light">‚òÄÔ∏è Claro / Light</option>
                    <option value="dark">üåô Oscuro / Dark</option>
                </select>
            </div>

            <div>
                <label class="block text-sm mb-1" id="lang-language">Idioma:</label>
                <select onchange="setLanguage(this.value)" id="lang-select" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-slate-700 text-sm outline-none">
                    <option value="es">Espa√±ol</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>
    </div>

    <div id="login" class="min-h-screen flex items-center justify-center p-6">
        <div class="glass-card bg-white p-10 rounded-[2.5rem] shadow-2xl w-full max-w-md text-center border border-gray-100">
            <h2 class="text-3xl font-bold mb-2" id="lang-login-title">Sistema de Notas</h2>
            <p class="text-gray-400 mb-8" id="lang-login-subtitle">Inicia sesi√≥n para continuar</p>
            
            <input type="text" id="usuario" placeholder="Usuario" class="w-full p-4 mb-4 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 transition">
            <input type="password" id="contrasena" placeholder="Contrase√±a" class="w-full p-4 mb-6 border border-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 transition">
            
            <button id="login-btn" class="w-full bg-[#5549e6] text-white py-4 rounded-2xl font-bold text-lg hover:opacity-90 shadow-lg shadow-indigo-100" id="lang-btn-login">Entrar</button>
            <p id="error-msg" class="text-red-500 mt-4 text-sm"></p>
        </div>
    </div>

    <div id="sistema" class="hidden min-h-screen">
        <nav class="navbar bg-white p-6 flex justify-between items-center shadow-sm border-b border-gray-100 dark:border-slate-800">
            <span id="welcome" class="font-semibold text-lg"></span>
            <button id="logout" class="text-red-500 font-bold border-2 border-red-500 px-6 py-2 rounded-xl hover:bg-red-50" id="lang-logout">Cerrar Sesi√≥n</button>
        </nav>

        <div id="panel-lectores" class="hidden max-w-5xl mx-auto mt-10 p-6">
            <div class="bg-[#5549e6] p-10 rounded-[2rem] text-white text-center shadow-xl">
                <h3 class="text-3xl font-bold mb-2" id="lang-welcome-back">¬°Bienvenidos!</h3>
                <p class="opacity-80 mb-8" id="lang-ask-notes">¬øQu√© notas desean ver hoy?</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button class="bg-white text-indigo-700 p-6 rounded-2xl font-bold hover:scale-105 transition shadow-lg" onclick="filtrarPorProfesor('fatima')">
                        üë©‚Äçüè´ Fatima Flores
                    </button>
                    <button class="bg-white text-indigo-700 p-6 rounded-2xl font-bold hover:scale-105 transition shadow-lg" onclick="filtrarPorProfesor('jorge')">
                        üë®‚Äçüè´ Jorge Flores
                    </button>
                </div>
            </div>
        </div>

        <main class="max-w-6xl mx-auto p-6 md:p-10">
            <div class="table-card bg-white rounded-[2.5rem] shadow-xl overflow-hidden border border-gray-100 dark:border-slate-800">
                <div class="p-8 border-b border-gray-100 dark:border-slate-800 flex justify-between">
                    <h2 id="titulo-tabla" class="text-2xl font-bold">Registro de Calificaciones</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="text-xs uppercase text-slate-400 font-bold tracking-widest border-b border-gray-100 dark:border-slate-800">
                                <th class="p-6" id="lang-th-subject">Materia</th>
                                <th class="p-6" id="lang-th-coti">Cotidiana</th>
                                <th class="p-6" id="lang-th-inte">Integradora</th>
                                <th class="p-6" id="lang-th-exam">Examen</th>
                                <th class="p-6 text-right" id="lang-th-final">Nota Final</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-cuerpo" class="divide-y divide-gray-50 dark:divide-slate-800"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // CONFIGURACI√ìN FIREBASE
        const firebaseConfig = { databaseURL: "https://notassv-ce8e1-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // USUARIOS SEG√öN TUS DATOS
        const usuarios = {
            "fatima.flores": { pass: "Ccsa2026.", rol: "editor", nombre: "Fatima", apellido: "Flores", materias: ["Lenguaje", "Matem√°ticas", "Sociales", "Ciencias", "OPV"] },
            "jorge.flores": { pass: "Atb2026.", rol: "editor", nombre: "Jorge", apellido: "Flores", materias: ["Ingl√©s", "Reading", "Conversation", "Inform√°tica", "Seminario"] },
            "jorge.flores1": { pass: "JFlores2026.", rol: "lector", nombre: "Jorge", apellido: "Lector" },
            "carmen.jovel": { pass: "CJovel2026.", rol: "lector", nombre: "Carmen", apellido: "Jovel" },
            "admin.notas": { pass: "Admin2026.", rol: "admin", nombre: "Administrador", apellido: "General" }
        };

        // TRADUCCIONES
        const translations = {
            es: {
                loginTitle: "Sistema de Notas",
                loginSubtitle: "Inicia sesi√≥n para continuar",
                btnLogin: "Entrar",
                customBtn: "Personalizar",
                settings: "Ajustes",
                theme: "Modo:",
                language: "Idioma:",
                logout: "Cerrar Sesi√≥n",
                welcomeBack: "¬°Bienvenidos!",
                askNotes: "¬øQu√© notas desean ver hoy?",
                thSubject: "Materia",
                thCoti: "Cotidiana",
                thInte: "Integradora",
                thExam: "Examen",
                thFinal: "Nota Final",
                hello: "Hola"
            },
            en: {
                loginTitle: "Grades System",
                loginSubtitle: "Sign in to continue",
                btnLogin: "Sign In",
                customBtn: "Customize",
                settings: "Settings",
                theme: "Theme:",
                language: "Language:",
                logout: "Logout",
                welcomeBack: "Welcome!",
                askNotes: "Whose grades do you want to see?",
                thSubject: "Subject",
                thCoti: "Classwork",
                thInte: "Integrative",
                thExam: "Exam",
                thFinal: "Final Grade",
                hello: "Hello"
            }
        };

        let currentLang = 'es';
        let userLogged = null;

        // FUNCIONES DE PERSONALIZACI√ìN
        function toggleCustomMenu() {
            document.getElementById('custom-menu').classList.toggle('show');
        }

        function setTheme(theme) {
            if(theme === 'dark') document.body.classList.add('dark');
            else document.body.classList.remove('dark');
            localStorage.setItem('theme', theme);
        }

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.getElementById('lang-login-title').innerText = t.loginTitle;
            document.getElementById('lang-login-subtitle').innerText = t.loginSubtitle;
            document.getElementById('login-btn').innerText = t.btnLogin;
            document.getElementById('lang-custom-btn').innerText = t.customBtn;
            document.getElementById('lang-settings').innerText = t.settings;
            document.getElementById('lang-theme').innerText = t.theme;
            document.getElementById('lang-language').innerText = t.language;
            document.getElementById('lang-logout').innerText = t.logout;
            document.getElementById('lang-welcome-back').innerText = t.welcomeBack;
            document.getElementById('lang-ask-notes').innerText = t.askNotes;
            document.getElementById('lang-th-subject').innerText = t.thSubject;
            document.getElementById('lang-th-coti').innerText = t.thCoti;
            document.getElementById('lang-th-inte').innerText = t.thInte;
            document.getElementById('lang-th-exam').innerText = t.thExam;
            document.getElementById('lang-th-final').innerText = t.thFinal;
            
            if(userLogged) {
                document.getElementById('welcome').innerText = `${t.hello}, ${userLogged.nombre} ${userLogged.apellido}`;
            }
            localStorage.setItem('lang', lang);
        }

        // L√ìGICA DE LOGIN
        document.getElementById('login-btn').addEventListener('click', () => {
            const u = document.getElementById('usuario').value;
            const p = document.getElementById('contrasena').value;

            if (usuarios[u] && usuarios[u].pass === p) {
                userLogged = usuarios[u];
                document.getElementById('login').classList.add('hidden');
                document.getElementById('sistema').classList.remove('hidden');
                
                // CAMBIO SOLICITADO: Nombre y Apellido
                const greeting = translations[currentLang].hello;
                document.getElementById('welcome').innerText = `${greeting}, ${userLogged.nombre} ${userLogged.apellido}`;

                if (userLogged.rol === "lector") {
                    document.getElementById('panel-lectores').classList.remove('hidden');
                } else {
                    // Admin ve todo, Editor solo lo suyo
                    const mats = userLogged.rol === "admin" ? [...usuarios["fatima.flores"].materias, ...usuarios["jorge.flores"].materias] : userLogged.materias;
                    dibujarTabla(mats);
                }
            } else {
                document.getElementById('error-msg').innerText = currentLang === 'es' ? "Credenciales inv√°lidas" : "Invalid credentials";
            }
        });

        function filtrarPorProfesor(prof) {
            const profObj = prof === 'fatima' ? usuarios["fatima.flores"] : usuarios["jorge.flores"];
            document.getElementById('titulo-tabla').innerText = "Notas: " + profObj.nombre + " " + profObj.apellido;
            dibujarTabla(profObj.materias);
        }

        function dibujarTabla(listaMaterias) {
            const tbody = document.getElementById('tabla-cuerpo');
            tbody.innerHTML = "";
            listaMaterias.forEach(m => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="p-6 font-semibold">${m}</td>
                    <td class="p-6 nota" data-m="${m}" data-c="cotidiana">-</td>
                    <td class="p-6 nota" data-m="${m}" data-c="integradora">-</td>
                    <td class="p-6 nota" data-m="${m}" data-c="examen">-</td>
                    <td class="p-6 text-right font-bold text-indigo-600 dark:text-indigo-400">0.0</td>
                `;
                tbody.appendChild(tr);
                if (userLogged.rol === "editor" || userLogged.rol === "admin") habilitarEdit(tr, m);
            });
            escucharFirebase();
        }

        function habilitarEdit(fila, m) {
            fila.querySelectorAll('.nota').forEach(td => {
                td.contentEditable = true;
                td.classList.add('bg-yellow-50', 'dark:bg-slate-700', 'rounded-lg');
                td.addEventListener('blur', (e) => {
                    const campo = e.target.getAttribute('data-c');
                    database.ref(`notas/${m}/${campo}`).set(e.target.innerText);
                });
            });
        }

        function escucharFirebase() {
            database.ref('notas').on('value', snap => {
                const datos = snap.val() || {};
                document.querySelectorAll('#tabla-cuerpo tr').forEach(fila => {
                    const m = fila.cells[0].innerText;
                    if (datos[m]) {
                        fila.cells[1].innerText = datos[m].cotidiana || "-";
                        fila.cells[2].innerText = datos[m].integradora || "-";
                        fila.cells[3].innerText = datos[m].examen || "-";
                        const f = (parseFloat(datos[m].cotidiana || 0) + parseFloat(datos[m].integradora || 0) + parseFloat(datos[m].examen || 0)) / 3;
                        fila.cells[4].innerText = isNaN(f) ? "0.0" : f.toFixed(1);
                    }
                });
            });
        }

        document.getElementById('logout').addEventListener('click', () => location.reload());

        // Cargar preferencias guardadas
        window.onload = () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const savedLang = localStorage.getItem('lang') || 'es';
            setTheme(savedTheme);
            setLanguage(savedLang);
            document.getElementById('theme-select').value = savedTheme;
            document.getElementById('lang-select').value = savedLang;
        };
    </script>
</body>
</html>
